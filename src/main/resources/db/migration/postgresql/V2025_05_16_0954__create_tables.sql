-- Create tables for Patient Trial database in PostgreSQL --

CREATE TABLE dbo.PATIENT
(
    ID              BIGSERIAL PRIMARY KEY,
    NAME            VARCHAR(255),
    DATE_OF_BIRTH   TIMESTAMP,
    GENDER          CHAR(1),
    MEDICAL_HISTORY VARCHAR(255),
    CREATED_AT      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE dbo.DRUG
(
    ID               BIGSERIAL PRIMARY KEY,
    NAME             VARCHAR(255),
    CHEMICAL_FORMULA VARCHAR(255),
    MANUFACTURER     VARCHAR(255),
    CREATED_AT       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE dbo.TRIAL
(
    ID                   BIGSERIAL PRIMARY KEY,
    NAME                 VARCHAR(255),
    START_DATE           TIMESTAMP,
    END_DATE             TIMESTAMP,
    PROTOCOL_DESCRIPTION VARCHAR(255),
    CREATED_AT           TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT           TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE dbo.PATIENT_TRIAL
(
    ID               BIGSERIAL PRIMARY KEY,
    PATIENT_ID       BIGINT    NOT NULL,
    TRIAL_ID         BIGINT    NOT NULL,
    ENROLLMENT_DATE  TIMESTAMP,
    TREATMENT_STATUS VARCHAR(255),
    CREATED_AT       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_PATIENT_TRIALS_PATIENT_ID FOREIGN KEY (PATIENT_ID) REFERENCES dbo.PATIENT (ID),
    CONSTRAINT FK_PATIENT_TRIALS_TRIAL_ID FOREIGN KEY (TRIAL_ID) REFERENCES dbo.TRIAL (ID)
);

CREATE TABLE dbo.PATIENT_TRIAL_DRUG
(
    ID                      BIGSERIAL PRIMARY KEY,
    PATIENT_TRIAL_ID        BIGINT    NOT NULL,
    DRUG_ID                 BIGINT    NOT NULL,
    DOSAGE                  NUMERIC   NOT NULL,
    DOSAGE_MEASUREMENT_TYPE VARCHAR(25),
    CREATED_AT              TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT              TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_PATIENT_TRIAL_DRUG_PATIENT_TRIAL_ID FOREIGN KEY (PATIENT_TRIAL_ID) REFERENCES dbo.PATIENT_TRIAL (ID),
    CONSTRAINT FK_PATIENT_TRIAL_DRUG_DRUG_ID FOREIGN KEY (DRUG_ID) REFERENCES dbo.DRUG (ID)
);

CREATE TABLE dbo.ADVERSE_EVENT
(
    ID                 BIGSERIAL PRIMARY KEY,
    PATIENT_ID         BIGINT    NOT NULL,
    TRIAL_ID           BIGINT    NOT NULL,
    EVENT_DESCRIPTION  VARCHAR(255),
    EVENT_SEVERITY     VARCHAR(255),
    DATE_OF_OCCURRENCE TIMESTAMP,
    CREATED_AT         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_ADVERSE_EVENTS_PATIENT_ID FOREIGN KEY (PATIENT_ID) REFERENCES dbo.PATIENT (ID),
    CONSTRAINT FK_ADVERSE_EVENTS_TRIAL_ID FOREIGN KEY (TRIAL_ID) REFERENCES dbo.TRIAL (ID)
);